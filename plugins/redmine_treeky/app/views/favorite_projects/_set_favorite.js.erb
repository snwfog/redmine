<% selector = "#favorite_project_#{@project.id}" %>
$("<%= selector %>").each(function()
{
  $parentTr = $(this).parents('tr');
  classProp = $parentTr.prop('class');

  if ("<%= favorite?(@project) %>" == "true")
  {
    if (/\bunfav\b/.exec(classProp))
    {
      $parentTr.prop('class', classProp.replace(/\bunfav\b/, 'fav'));
    }
  }
  else
  {
    if (/\bfav\b/.exec(classProp))
    {
      $parentTr.prop('class', classProp.replace(/\bfav\b/, 'unfav'));
    }

  }

  $(this).replaceWith("<%= j favorite_tag(@project, User.current) %>");

});

<% @project = nil %>
$('#quick-search > select').html("<%= j render_project_jump_box %>");

