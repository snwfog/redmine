// Generated by CoffeeScript 1.6.2
(function() {
  $(function() {
    $('tbody tr form').on('ajax:success', function(evt, data, status, xhr) {
      var $parentTr, submitType;

      $parentTr = $(this).parents('tr');
      submitType = $(this).find('input[name="_method"]');
      if ($parentTr.hasClass('fav')) {
        $parentTr.removeClass('fav').addClass('unfav');
        $(this).find('input[type="submit"]').removeClass('fav').addClass('unfav');
        if (submitType != null) {
          return submitType.attr('value', 'post');
        }
      } else if ($parentTr.hasClass('unfav')) {
        $parentTr.removeClass('unfav').addClass('fav');
        if (submitType == null) {
          $(this).find('form').prepend($('<input>').attr('name', '_method').attr('type', 'hidden'));
        }
        submitType.attr('value', 'delete');
        return $(this).find('input[type="submit"]').removeClass('unfav').addClass('fav');
      }
    }).bind('ajax:failure', function(evt, data, status, xhr) {
      return console.log("Something went horribly wrong. And it's all Charles' faults");
    });
    $('.project-custom-label-filter').change(function(e) {
      $(this).find('input[type=checkbox]').each(function() {
        var $td, classId;

        classId = $(this).data('field');
        $td = $("#projects-list .custom-field-" + classId);
        if ($(this).is(':checked')) {
          return $td.css("display", "");
        } else {
          return $td.css("display", "none");
        }
      });
      return $(this).submit();
    });
    $('#collapse-expand-all-projects').on('click', function(e) {
      var $anchor;

      e.preventDefault();
      $anchor = $(this);
      if ($anchor.hasClass('expanded')) {
        $anchor.addClass('collapsed').removeClass('expanded');
        $('tr.open.parent span.expander').toggleExpander();
        $anchor.html("Expand All");
      } else if ($anchor.hasClass('collapsed')) {
        $anchor.addClass('expanded').removeClass('collapsed');
        $('tr.closed.parent span.expander').toggleExpander();
        $anchor.html("Collapse All");
      }
      return $('tbody tr:not(tr.hide)').redrawTableStrip();
    });
    $('#only-favorite-projects').on('click', function(e) {
      var $anchor;

      e.preventDefault();
      $anchor = $(this);
      if ($anchor.hasClass('all')) {
        $anchor.removeClass('all').addClass('fav');
        $anchor.html("Show All Projects");
        $('tr.closed.parent span.expander').toggleExpander();
        $('#collapse-expand-all-projects').css({
          'display': 'none'
        });
        $('tr span.expander').hide();
        $('#projects-list tbody tr').each(function() {
          if ($(this).hasClass('fav')) {
            $(this).removeClass('hide');
          }
          if (!$(this).hasClass('fav')) {
            return $(this).addClass('hide');
          }
        });
      } else if ($anchor.hasClass('fav')) {
        $anchor.removeClass('fav').addClass('all');
        $anchor.html("Only Favorites");
        $('tr span.expander').show();
        $('#collapse-expand-all-projects').css({
          'display': ''
        });
        $('#projects-list tbody tr').each(function() {
          return $(this).removeClass('hide');
        });
        $('tr.closed.parent span.expander').toggleExpander();
        $('#collapse-expand-all-projects').html("Collapse All");
        $('#collapse-expand-all-projects').removeClass('collapsed').addClass('expanded');
      }
      return $('tbody tr:not(tr.hide)').redrawTableStrip();
    });
    $.fn.toggleExpander = function() {
      return this.each(function() {
        if (typeof this.onclick === 'function') {
          return this.onclick.call();
        }
      });
    };
    $.fn.redrawTableStrip = function() {
      var alt;

      alt = 1;
      return this.find('tbody tr:not(tr.hide)').each(function() {
        var klass, _ref;

        $(this).removeClass('even odd');
        klass = (_ref = ((alt++) % 2) === 0) != null ? _ref : {
          "even": "odd"
        };
        return $(this).addClass(klass);
      });
    };
    $('#only-favorite-projects').trigger('click');
    return $('.project-custom-label-filter').trigger('change');
  });

}).call(this);
